%description:

Checks if module interface lookup fails when the Ipv4NetworkLayer module is directly connected to the EthernetInterface module.

%file: test.ned

import inet.linklayer.ethernet.basic.EthernetInterface;
import inet.networklayer.ipv4.Ipv4NetworkLayer;
import inet.networklayer.common.InterfaceTable;

network TestNetwork
{
    parameters:
        *.interfaceTableModule = absPath(".interfaceTable");
        @networkNode;
    gates:
        inout phys;
    submodules:
        interfaceTable: InterfaceTable;
        ip: Ipv4NetworkLayer;
        interface: EthernetInterface;
    connections allowunconnected:
        ip.ifOut --> interface.upperLayerIn;
        ip.ifIn <-- interface.upperLayerOut;
        interface.phys <--> phys;
}

%inifile: omnetpp.ini

[General]
network = TestNetwork
ned-path = .;../../../../src
sim-time-limit = 0s

cmdenv-log-prefix = "%>"

%exitcode: 1

%contains-regex: stderr
<!> Error: Cannot find referenced module interface.*protocol = ipv4.*

%#--------------------------------------------------------------------------------------------------------------
%postrun-command: grep "undisposed object:" test.out > test_undisposed.out || true
%not-contains: test_undisposed.out
undisposed object: (
%#--------------------------------------------------------------------------------------------------------------
