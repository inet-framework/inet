%description:
Tests constant drift oscillator.

%includes:
#include "inet/clock/contract/IOscillator.h"

using namespace omnetpp;
using namespace inet;

%file: TestNetwork.ned

import inet.clock.oscillator.ConstantDriftOscillator;

network TestNetwork
{
    submodules:
        test: Test;
        oscillator: ConstantDriftOscillator;
}

%inifile: omnetpp.ini
[General]
ned-path = .;../../../../src;../../lib
network = TestNetwork

*.oscillator.nominalTickLength = 2ps
*.oscillator.driftRate = 1000000 ppm

%activity:

#define CHECK(x) { auto r = oscillator->x; std::cout << #x << " -> "<< r << std::endl; }

auto oscillator = check_and_cast<IOscillator *>(cSimulation::getActiveSimulation()->getModuleByPath("oscillator"));
CHECK(computeTicksForInterval(0));

CHECK(computeIntervalForTicks(0));

%contains-regex: stdout
.*?computeTicksForInterval\(0\) -> 0
.*?computeIntervalForTicks\(0\) -> 0
$